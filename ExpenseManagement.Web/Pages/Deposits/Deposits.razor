@page "/app/deposits"

<PageTitle>Deposits</PageTitle>

<div class="container mt-4">
	<div class="card shadow-lg border-0">
		<div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
			<h4 class="mb-0">
				<i class="bi bi-list-ul me-2"></i> Deposit List
			</h4>
			<button class="btn btn-light btn-sm" @onclick="() => OnDepositCreateUpdateClick(0)">
				<i class="bi bi-plus-circle me-1"></i> Add Deposit
			</button>
		</div>

		<div class="card-body">
			<div class="table-responsive">
				@if (IsLoading)
				{
					<p style="text-align: center; padding: 8px 0;">Loading...</p>
				}   
				else  
				{
					<table class="table table-hover align-middle">
						<thead class="table-light">
							<tr>  
								<th>#</th>
								<th>Deposit ID</th>
								<th>Date</th>
								<th>Remarks</th>
								<th class="text-left">Amount</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							@if (DepositViewModels.Any())
							{
								foreach (var item in DepositViewModels)
								{
									<tr>
										<td style="@(item.InActive ? "color: red" : "color: #000000")">@SL</td>
										<td style="@(item.InActive ? "color: red" : "color: #000000")">@item.DepositId</td>
										<td style="@(item.InActive ? "color: red" : "color: #000000")">@item.DepositDate.ToString("dd MMM, yyyy")</td>
										<td style="@(item.InActive ? "color: red" : "color: #000000")">@item.Remarks</td>
										<td style="@(item.InActive ? "color: red;" : "color: #000000;")">@item.DepositAmount</td>
										<td>
											<button class="btn btn-sm btn-outline-info me-2" @onclick="() => OnDepositViewClick(item.DepositId)">
												<i class="bi bi-eye"></i>
											</button>
											<button class="btn btn-sm btn-outline-primary me-2" @onclick="() => OnDepositCreateUpdateClick(item.DepositId)">
												<i class="bi bi-pencil"></i>
											</button>
											<button class="btn btn-sm btn-outline-danger" @onclick="() => OnDepositDeleteClickAsync(item.DepositId)">
												<i class="bi bi-trash"></i>
											</button>
										</td>
									</tr>
									SL++;
								}
							}
							else
							{
								<tr>
									<td colspan="6" style="text-align: center; padding: 8px 0; color: red;">No Record Found!</td>
								</tr>
							}
						</tbody>
						@if (DepositViewModels.Any())
						{
							<tfoot>
								<tr>
									<th colspan="4" class="text-center">Total Amount:</th>
									<th class="text-left">@(TotalAmount)</th>
									<th></th>
								</tr>
							</tfoot>
						}
					</table>
				}
			</div>
		</div>
	</div>
</div>

@code {
	[Parameter]
	public long DepositId { get; set; }
	private long SL { get; set; } = 1;
	private bool IsLoading { get; set; } = false;
	private decimal TotalAmount { get; set; } = 0;
	private List<DepositViewModel> DepositViewModels { get; set; } = [];

	protected async override Task OnInitializedAsync()
	{
		IsLoading = true;
		await LoadDepositsAsync();
		IsLoading = false;
	}  

	private async Task LoadDepositsAsync()
	{
		DepositViewModels = await DepositApiService.GetDepositAsync();
		TotalAmount = DepositViewModels.Where(x => !x.InActive).Sum(s => s.DepositAmount);
	}

	private void OnDepositViewClick(long depositId)
	{
		NavigationManager.NavigateTo($"/app/deposits/{depositId}");
	}

	private void OnDepositCreateUpdateClick(long depositId)
	{
		NavigationManager.NavigateTo($"/app/deposits/edit-form/{depositId}");
	}

	private async Task OnDepositDeleteClickAsync(long depositId)
	{
		var response = await DepositApiService.DeleteDepositsAsync(depositId);
		if (response.Code == 200)
			await LoadDepositsAsync();
		StateHasChanged();
	}
}

